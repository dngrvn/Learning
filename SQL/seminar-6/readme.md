# Базы данных и SQL (семинары)
## Урок 6. SQL – Транзакции. Временные таблицы, управляющие конструкции, циклы

---

**Для решения задач используйте базу данных lesson4**  
(_скрипт создания, прикреплен к 4 семинару_).

> Создайте таблицу users_old, аналогичную таблице users. Создайте процедуру, с помощью которой можно переместить любого (одного) пользователя из таблицы users в таблицу users_old. (использование транзакции с выбором commit или rollback – обязательно).  

```
Скрипт создает таблицу "users_old" с четырьмя столбцами: id, firstname, lastname и email. Затем он определяет хранимую процедуру "move", которая принимает один параметр "num1" типа INT. Внутри процедуры, она вставляет данные из таблицы "users" в таблицу "users_old" для записи с указанным id, а затем удаляет эту запись из таблицы "users". Наконец, процедура вызывается с параметром 4.

Проверьте, что таблица "users" существует и содержит запись с id равным 4 перед вызовом процедуры "move".
```

>Создайте хранимую функцию hello(), которая будет возвращать приветствие, в зависимости от текущего времени суток. С 6:00 до 12:00 функция должна возвращать фразу "Доброе утро", с 12:00 до 18:00 функция должна возвращать фразу "Добрый день", с 18:00 до 00:00 — "Добрый вечер", с 00:00 до 6:00 — "Доброй ночи".

```
Этот скрипт создает функцию с именем "hello". Функция возвращает приветствие в зависимости от текущего времени. Если текущее время находится в диапазоне от 12:00:00 до 18:00:00, то возвращается "Добрый день". Если текущее время находится в диапазоне от 06:00:00 до 12:00:00, то возвращается "Доброе утро". Если текущее время находится в диапазоне от 00:00:00 до 06:00:00, то возвращается "Доброй ночи". Во всех остальных случаях возвращается "Добрый вечер".

После создания функции, код выполняет следующие действия:

Вызывает функцию "hello()" для пользователя с идентификатором "num1" из таблицы "users".
Удаляет пользователя с идентификатором "num1" из таблицы "users".
Фиксирует изменения в базе данных.
```

>(по желанию)* Создайте таблицу logs типа Archive. Пусть при каждом создании записи в таблицах users, communities и messages в таблицу logs помещается время и дата создания записи, название таблицы, идентификатор первичного ключа.

```
Скрипт создает таблицу "logs" с четырьмя столбцами: "table_name" типа VARCHAR(20), "pk_id" типа INT UNSIGNED, "name" типа VARCHAR(255) и "created_at" типа DATETIME со значением по умолчанию NOW(). Затем создаются три триггера: "users_log", "communities_log" и "messages_log". Каждый триггер срабатывает после вставки новой записи в соответствующую таблицу ("users", "communities" и "messages") и вставляет новую запись в таблицу "logs" с указанием имени таблицы и значениями "pk_id" идентификатора новой записи.
```